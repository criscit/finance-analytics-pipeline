version: 2

models:
  - name: stg_load_t_bank_transactions
    description: >
      Staging over prod_raw.t_bank_transactions using seed-based column mapping.
    tags: [staging, t_bank]
    meta:
      source_table: prod_raw.t_bank_transactions
      seed_name: t_bank

    columns:
      - name: __load_key
        description: Load key for the transaction.
        data_type: varchar(32)
        data_tests: [not_null, unique]

      - name: card_last4
        description: Last digits of the card.
        data_type: varchar(5)

      - name: status_nm
        description: Bank-provided status of the transaction.
        data_type: varchar(10)
        data_tests:
          - accepted_values:
              values: ['OK', 'FAILED']
          - not_null

      - name: category_nm
        description: Bank-assigned spending category label.
        data_type: varchar(128)

      - name: mcc_cd
        description: Merchant Category Code (MCC) as text.
        data_type: varchar(10)

      - name: description
        description: Free-text operation description from the export.
        data_type: varchar(256)

      - name: transaction_amt
        description: Amount actually charged/posted, in transaction currency.
        data_type: double
        data_tests:
          - not_null

      - name: transaction_currency_cd
        description: ISO-like currency code of the posted transaction.
        data_type: varchar(3)
        data_tests:
          - accepted_values:
              values: ['RUB']
              severity: warn
          - not_null

      - name: transacted_at_utc
        description: timestamp of the transaction with UTC timezone.
        data_type: timestamp
        data_tests:
          - not_null

      - name: merchant_amt
        description: Amount at operation time, in operation currency.
        data_type: double

      - name: merchant_currency_cd
        description: ISO-like currency code of the operation.
        data_type: varchar(3)

      - name: posted_on
        description: Payment date.
        data_type: date

      - name: cashback_amt
        description: Cashback amount granted for the transaction.
        data_type: integer

      - name: total_rewards_amt
        description: Total rewards for the transaction, including cashback.
        data_type: double

      - name: rounded_transaction_amt
        description: Operation amount after rounding logic applied by bank.
        data_type: double

      - name: savings_jar_amt
        description: Round-up amount sent to the investment jar.
        data_type: double

      - name: __ingested_at
        description: timestamp of the ingestion.
        data_type: timestamp
        data_tests:
          - not_null
