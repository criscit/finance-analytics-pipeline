version: 2

models:
  - name: mart_t_bank_transactions
    description: >
      Mart table for bank transactions analytics with successful transactions only.
      This table contains filtered transaction data for analytics purposes with Moscow timezone.
    tags: [marts, t_bank, analytics]
    meta:
      materialization: incremental
      incremental_strategy: merge
      unique_key: transaction_bk

    columns:
      - name: transaction_bk
        description: Business key for the transaction, generated from MD5 hash of key fields.
        data_type: varchar(32)
        data_tests:
          - not_null
          - unique

      - name: category_nm
        description: Bank-assigned spending category label.
        data_type: varchar(128)

      - name: description
        description: Free-text operation description from the bank export.
        data_type: varchar(256)

      - name: transaction_amt
        description: Amount actually charged/posted, in transaction currency.
        data_type: double
        data_tests:
          - not_null

      - name: transaction_currency_cd
        description: ISO-like currency code of the posted transaction.
        data_type: varchar(3)
        data_tests:
          - accepted_values:
              values: ['RUB']
              severity: warn
          - not_null

      - name: transaction_dt
        description: Date of the transaction in Europe/Moscow timezone.
        data_type: date
        data_tests:
          - not_null

      - name: total_rewards_amt
        description: Total rewards for the transaction, including cashback.
        data_type: double
        data_tests:
          - not_null

      - name: __ingested_at
        description: Timestamp of the ingestion for incremental processing.
        data_type: timestamp
        data_tests:
          - not_null
